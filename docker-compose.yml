services:
  agent:
    build: .
    volumes:
      # エージェントシステム自体のコードをマウント
      - .:/workspace
      # 作業対象のプロジェクトディレクトリをマウント
      # TARGET_PROJECT環境変数で指定（未指定の場合は現在のディレクトリ）
      - ${TARGET_PROJECT:-.}:/target
      # 状態ファイルを永続化（オプション）
      - ./state:/workspace/state
      - ./logs:/workspace/logs
      # Cursor CLIの認証情報を永続化（重要）
      # 認証情報は /root/.cursor と /root/.config/cursor の両方に保存される
      - cursor-config:/root/.cursor
      - cursor-config-config:/root/.config/cursor
    environment:
      # 作業対象プロジェクトのルート（TARGET_PROJECTが設定されている場合は/target、未設定の場合は/workspace）
      - PROJECT_ROOT=${PROJECT_ROOT:-/target}
      - LOG_LEVEL=INFO
      - PROJECT_GOAL=${PROJECT_GOAL:-プロジェクトの目標を設定してください}
    working_dir: /workspace
    # コマンド制限をかけない（すべての権限を許可）
    privileged: false
    # ネットワークアクセスを許可（API呼び出し用）
    network_mode: bridge
    # 長時間実行を許可
    restart: unless-stopped
    # インタラクティブモードで実行（初回認証用）
    stdin_open: true
    tty: true

volumes:
  cursor-config:
    # Cursor CLIの認証情報を永続化（/root/.cursor）
  cursor-config-config:
    # Cursor CLIの認証情報を永続化（/root/.config/cursor）
