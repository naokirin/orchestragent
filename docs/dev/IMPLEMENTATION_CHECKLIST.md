# 実装前チェックリスト

## 技術調査

### Cursor CLI/API
- [x] Cursor CLIの公式ドキュメントを確認（https://cursor.com/ja/docs/cli/overview）
- [x] `agent --help` でCLIの存在を確認
- [x] `agent` コマンドのインストール確認（`curl https://cursor.com/install -fsS | bash`）
- [x] 非対話モード（`-p` フラグ）の動作確認
- [ ] 出力のキャプチャ方法を確認
- [ ] レート制限を確認（要調査）

### LLM API（Phase 4以降で検討）
- [ ] ~~使用するLLM APIを決定~~（Phase 4で検討）
- [ ] ~~APIキーを取得~~（Phase 4で検討）
- [ ] ~~レート制限とコストを確認~~（Phase 4で検討）

**注意**: 初期実装ではCursor CLIのみを使用。抽象化レイヤーを設計して、後からLLM API直接呼び出しに差し替え可能にする。

### 開発環境
- [ ] Dockerがインストールされている（必須）
- [ ] docker-composeがインストールされている（推奨）
- [ ] Python 3.8+ がインストールされている（コンテナ内で使用）
- [ ] 必要なライブラリを確認（requirements.txtを作成予定）
- [ ] Gitがインストールされている（コンテナ内で使用）
- [ ] テスト用のプロジェクトリポジトリを準備

### 実行環境（Sandbox/DevContainer）
- [ ] Dockerfileを作成
- [ ] docker-compose.ymlを作成（または.devcontainer/devcontainer.json）
- [ ] Cursor CLIのインストール手順を確認
- [ ] ボリュームマウントの設定を確認（認証情報の永続化を含む）
- [ ] 環境変数の設定方法を確認（API Keyは不要）
- [ ] コンテナ内での実行テスト
- [ ] **OAuth認証の手順を確認**
  - [ ] 初回実行時の認証URL表示を確認
  - [ ] ホスト側のブラウザでの認証手順を確認
  - [ ] 認証情報の永続化を確認

## 設計確認

### アーキテクチャ
- [ ] ディレクトリ構造を決定
- [ ] 状態管理の方法を決定（ファイルベースでOK）
- [ ] エージェント間の通信方法を決定
- [ ] エラーハンドリングの方針を決定

### データ構造
- [ ] `tasks.json` の構造を確定
- [ ] `status.json` の構造を確定
- [ ] `plan.md` の形式を確定
- [ ] ログファイルの形式を確定

### プロンプト
- [ ] Planner用プロンプトの初版を作成
- [ ] Worker用プロンプトの初版を作成
- [ ] Judge用プロンプトの初版を作成
- [ ] プロンプトテンプレートの変数を確定

## 実装準備

### Phase 1: 最小動作確認
- [ ] 状態管理ユーティリティ（StateManager）を実装
- [ ] Cursor/LLM API クライアント（抽象化レイヤー）を実装
- [ ] ロギング機能を実装
- [ ] Plannerエージェントの基本実装
- [ ] 単体テスト（Plannerのみ）を実行

### Phase 2: 基本ループ
- [ ] メインループの実装
- [ ] Workerエージェントの実装
- [ ] Judgeエージェントの実装
- [ ] エージェント間の連携テスト

### Phase 3: 安定化
- [x] エラーハンドリングとリトライロジック
- [x] 状態の永続化と復元機能
- [x] 詳細なログ機能
- [x] 進捗モニタリング機能

## 設定とセキュリティ

### 設定ファイル
- [ ] `config.py` または `config.json` を作成
- [ ] APIキーの管理方法を決定（環境変数推奨）
- [ ] プロジェクト目標の設定方法
- [ ] 待機時間の設定（5分以上）

### セキュリティ
- [ ] APIキーを`.gitignore`に追加
- [ ] 機密情報を含むファイルを除外
- [ ] ログファイルに機密情報が含まれないように注意

## テスト計画

### 小規模テスト
- [ ] 簡単なプロジェクト（例：Hello World）でテスト
- [ ] 単一タスクの実行を確認
- [ ] 状態ファイルの読み書きを確認
- [ ] ログの出力を確認

### 中規模テスト
- [ ] 複数タスクの連続実行を確認
- [ ] エージェント間の連携を確認
- [ ] エラーハンドリングを確認
- [ ] 長時間動作（1時間程度）を確認

### 本番前テスト
- [ ] 数時間の連続動作を確認
- [ ] 状態の復元を確認
- [ ] コスト監視を確認
- [ ] ドリフト検出を確認

## ドキュメント

### 実装ドキュメント
- [ ] コードにコメントを追加
- [ ] 各モジュールのdocstringを記述
- [ ] 使用方法のドキュメントを作成

### 運用ドキュメント
- [ ] セットアップ手順を記述
- [ ] トラブルシューティングガイドを作成
- [ ] よくある質問（FAQ）を作成

## リスク管理

### 技術的リスク
- [ ] Cursor CLI/APIが使えない場合の代替案を準備
- [ ] APIレート制限に達した場合の対応を準備
- [ ] 状態ファイルが破損した場合の復旧方法を準備

### 運用リスク
- [ ] コスト上限を設定
- [ ] 異常終了時の通知方法を検討
- [ ] 定期的なバックアップ方法を検討

## 実装開始前の最終確認

- [ ] すべてのドキュメントを確認
- [ ] 技術調査が完了している
- [ ] 設計が確定している
- [ ] テスト計画が明確になっている
- [ ] リスク対策が準備されている

---

**注意**: このチェックリストは、実装を開始する前に確認すべき項目をまとめたものです。すべての項目を完了する必要はありませんが、Phase 1の実装を開始する前に、少なくとも「技術調査」と「設計確認」の主要項目は完了することを推奨します。
